<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>信息管理系统</title>
    <link href="~/Content/scripts/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/styles/learun-login.css" rel="stylesheet" />
    <link href="~/Content/styles/font-awesome.min.css" rel="stylesheet" />
    <link rel="icon" href="~/Content/images/favicon.ico">
    <script src="~/Content/scripts/jquery/jquery-1.10.2.min.js"></script>
    <script src="~/Content/scripts/plugins/jquery.md5.js"></script>
    <script src="~/Content/scripts/plugins/cookie/jquery.cookie.js"></script>
    <script src="~/Content/scripts/plugins/dialog/dialog.js"></script>
    <script src="~/Content/scripts/plugins/validator/validator.js"></script>
    <script src="~/Content/scripts/plugins/tipso.min.js"></script>
    <script>
        $.post("/Login/IsLogin", {}, function (re) {
            if (re.IsLogin) location.href = "/Home/AdminLTE";
        }, "json");//20190326新加功能 用于登录跳转

        var contentPath = '/'.substr(0, '/'.length - 1);
        var isIE = !!window.ActiveXObject;
        var isIE6 = isIE && !window.XMLHttpRequest;
        if (isIE6) {
            window.location.href = contentPath + "/Error/ErrorBrowser";
        }
        //回车键
        document.onkeydown = function (e) {
            if (!e) e = window.event;
            if ((e.keyCode || e.which) == 13) {
                var btlogin = document.getElementById("btnlogin");
                btnlogin.click();
            }
        }
        $(function () {
            initialPage();
            $(window).resize(function (e) {
                window.setTimeout(initialPage, 200);
                e.stopPropagation();
            });
            initialControl();
        });

        function initialPage() {
            var wHeight = $(window).height();
            var wWidth = $(window).width();
            var topHeight = (wHeight - 524) / 2;
            var leftWidth = (wWidth - 1024) / 2;
            $(".lr-login-top").css("margin-top", (topHeight - 56) + "px");
            $(".menu").css("top", (topHeight + 50) + "px");
            $(".lr-bg-left").width(leftWidth);
            $(".lr-bg-right").width(leftWidth);
        }

        function initialControl() {
            //错误提示
            if (top.$.cookie('learun_login_error') != null) {
                switch (top.$.cookie('learun_login_error')) {
                    case "Overdue":
                        formMessage('登录已超时,请重新登录');
                        break;
                    case "OnLine":
                        formMessage('您的帐号已在其它地方登录,请重新登录');
                        break;
                    case "noCache":
                        formMessage('缓存过期,请重新登录');
                        break;
                    case "-1":
                        formMessage('未知错误,请重新登录');
                        break;
                    default:
                        break;
                }
                top.$.cookie('learun_login_error', '', { path: "/", expires: -1 });
            }
            //是否自动登录
            if (top.$.cookie('learn_autologin') == 1) {
                $("#autologin").attr("checked", 'true');
                $("#username").val(top.$.cookie('learn_username'));
                $("#password").val(top.$.cookie('learn_password'));
                CheckLogin(1);
            }
            //设置下次自动登录
            $("#autologin").click(function () {
                if (!$(this).attr('checked')) {
                    $(this).attr("checked", 'true');
                    top.$.cookie('learn_autologin', 1, { path: "/", expires: 7 });
                } else {
                    $(this).removeAttr("checked");
                    top.$.cookie('learn_autologin', '', { path: "/", expires: -1 });
                    top.$.cookie('learn_username', '', { path: "/", expires: -1 });
                    top.$.cookie('learn_password', '', { path: "/", expires: -1 });
                }
            });
            //主题风格
            var learn_UItheme = top.$.cookie('learn_UItheme');
            if (learn_UItheme) {
                $("#UItheme").val(learn_UItheme);
            }
            //登录按钮事件
            $("#btnlogin").click(function () {
                var $username = $("#username");
                var $password = $("#password");
                var $verifycode = $("#verifycode");
                if ($username.val() == "") {
                    $username.focus();
                    formMessage('请输入账户。');
                    return false;
                } else if ($password.val() == "") {
                    $password.focus();
                    formMessage('请输入密码。');
                    return false;
                } else if ($verifycode.val() == "") {
                    $verifycode.focus();
                    formMessage('请输入验证码。');
                    return false;
                } else {
                    CheckLogin(0);
                }
            });
            //点击切换验证码
            $("#login_verifycode").click(function () {
                $("#verifycode").val('');
                $("#login_verifycode").attr("src", contentPath + "/Login/VerifyCode?time=" + Math.random());
            });
            //切换注册表单
            $("#a_register").click(function () {
                $("#lr-login-form").hide();
                $("#lr-register-form").show();
                $("#register_verifycode").attr("src", contentPath + "/Login/VerifyCode?time=" + Math.random());
            });
            //切换登录表单
            $("#a_login").click(function () {
                $("#lr-login-form").show();
                $("#lr-register-form").hide();
                $("#login_verifycode").attr("src", contentPath + "/Login/VerifyCode?time=" + Math.random());
            });
        }

        //登录验证
        function CheckLogin(autologin) {
            formMessage('系统正在登录，请稍后...');
            $("#btnlogin").addClass('active').attr('disabled', 'disabled');
            $("#btnlogin").find('span').hide();

            var username = $.trim($("#username").val());
            var password = $.trim($("#password").val());

            var verifycode = $.trim($("#verifycode").val());
            //if (top.$.cookie('learn_password') == "" || top.$.cookie('learn_password') == null || autologin == 0) {
            //    password = $.md5(password);
            //}
            if (autologin == 0) {
                password = $.md5(password);
            }
            $.ajax({
                url: contentPath + "/Login/CheckLogin",
                data: { username: $.trim(username), password: $.trim(password), verifycode: verifycode, autologin: autologin },
                type: "post",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    if (data.type == 1) {

                        if (top.$.cookie('learn_autologin') == 1) {
                            top.$.cookie('learn_username', $.trim(username), { path: "/", expires: 7 });
                            top.$.cookie('learn_password', $.trim(password), { path: "/", expires: 7 });
                        }
                        //跳转主页
                        window.location.href = contentPath + '/Home/AdminLTE';

                    } else {
                        if (data.message.length >= 30) {
                            dialogAlert(data.message, 0);
                        } else {
                            formMessage(data.message);
                        }
                        $("#btnlogin").removeClass('active').removeAttr('disabled');
                        $("#btnlogin").find('span').show();
                        $("#login_verifycode").trigger("click");
                    }
                }
            });
        }

        //提示信息
        function formMessage(msg, type) {
            $('.login_tips').remove();
            $('.login_tips-succeed').remove();
            var _class = "login_tips";
            if (type == 1) {
                _class = "login_tips-succeed";
            }
            $('.form-message').prepend('<div class="' + _class + '"><i class="fa fa-question-circle"></i>' + msg + '</div>');
        }

        function formMessageRemove() {
            $('.login_tips').remove();
            $('.login_tips-succeed').remove();
        }

        function dialogAlert(msg, type) {
            if (type == -1) {
                type = 2;
            }
            top.layer.alert(msg, {
                icon: type,
                title: "提示"
            });
        }

    </script>    
</head>
<body class="Loginbody">
    <div class="wp">
        <div class="logo">
            <!--<img src="/Content/Images/loginlogo.png" />-->
            <div class="title-zh">个人信用管理系统</div>
            <div class="title-en">Personal Credit Management System</div>
        </div>
        <div class="content">
            <!--左侧背景图片-->
            <div class="img-bj">
                <img src="~/Content/images/login/login1.jpg" alt="">
            </div>
            <!--左侧背景图片 end-->
            <!--右侧表单-->
            <div class="Loginform">
                <div class="form-tit">
                    <span>请登录</span>
                </div>
                <div class="form-bd">

                    <form role="form" id="loginFun" method="post">
                        <div class="form-account  form-group-lg input-group">
                            <span class="input-group-addon "><i class="glyphicon glyphicon-user"></i>账户：</span>
                            <input class="form-control" id="username" type="text" value="">

                        </div>
                        <div class="form-password form-group-lg input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i>密码：</span>
                            <input class="form-control" id="password" type="password" placeholder="密码" value="">
                        </div>
                        <div class="form-message" id="message"></div>
                        <div class="form-bottom">
                            <button type="button" id="btnlogin" class="btn btn1 btn-primary">登录</button>
                            <button type="button" class="btn btn2 btn-primary">重置</button>
                        </div>

                    </form>

                </div>

            </div>
            <!--右侧表单 end-->
        </div>
        <div style="text-align: center; margin: 20px; font-family: Microsoft Yahei; color: #fff; margin: auto; width: 983px; padding-top: 30px;">
            <p>
                适用浏览器：IE9以上、360极速模式、FireFox、Chrome
                <a href="\Content\soft\360se8.1.1.406.exe">推荐浏览器下载|</a>
                 
            </p>
        </div>
        <div class="copyright">
            <span>copyright@2019 个人信息管理系统</span>
            @*&nbsp&nbsp&nbsp by&nbsp&nbsp&nbsp <a href="http://www.XXXX.com" target="_blank">XX科技 </a>*@
        </div>
    </div>

    <script type="text/javascript">
        //    检查浏览器是否是ie9以下
        var Sys = {};
        var ua = navigator.userAgent.toLowerCase();
        var s;
        (s = ua.match(/msie ([\d.]+)/)) ? Sys.ie = s[1] :
                (s = ua.match(/firefox\/([\d.]+)/)) ? Sys.firefox = s[1] :
                        (s = ua.match(/chrome\/([\d.]+)/)) ? Sys.chrome = s[1] :
                                (s = ua.match(/opera.([\d.]+)/)) ? Sys.opera = s[1] :
                                        (s = ua.match(/version\/([\d.]+).*safari/)) ? Sys.safari = s[1] : 0;

        //以下进行测试
        if (Sys.ie) document.write('IE: ' + Sys.ie);
        var str = "您的浏览器版本是IE" + Sys.ie + "请升级到IE9以上，或者切换至360浏览器极速模式、谷歌浏览器或火狐浏览器！";
        if (Sys.ie < 9) {
            alert(str);
        };

    </script>
</body>
</html>
