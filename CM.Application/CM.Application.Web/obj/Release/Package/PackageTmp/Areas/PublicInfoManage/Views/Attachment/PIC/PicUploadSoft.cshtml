@{;
    ViewBag.Title = "MES订单:表单页面-图纸上传";
    Layout = "~/Views/Shared/_Form.cshtml";
}



@*////////////////////////////////上传JS-开始////////////////////////////*@
<script>
    //158原始 上传
    function uploadPic() {

        var folder = "0工序程序";

        folder = escape(folder);

        var target = parent.$('<div></div>').appendTo('body');
        var url = '/PublicInfoManage/Attachment/PicUpload?picType=4&folder=' + folder;
        var opt = {
            title: '上传',
            width: '800px',
            height: '500px',
            modal: true,
            collapsible: false,
            minimizable: false,
            maximizable: true,
            queueSizeLimit: 1, //同时上传文件的个数
            fileTypeDesc: 'excel文件', //可选择文件类型说明
            fileTypeExts: '.xls', //控制可上传文件的扩展名
            filetype: "image/*",
            multi: false, //允许多文件上传
            closable: true,
            onOpen: function () {
                parent.$.messager.progress({
                    title: '提示',
                    text: '数据处理中，请稍后....'
                });
            }
        };
        opt.content = "<iframe src='" + url + "' style='height:100%;width:100%;border:0;display:block;' frameborder='0'></iframe>";

        opt.onRefresh = function (data) {  //可接收选择数据
            var obj = $.parseJSON(data);
            console.log(obj);
            var downloadUrl = '/PublicInfoManage/Attachment/DownloadFile?id=' + obj.id;
            var disphtml = "<span style='min-width:10px; display:inline-block;color:blue;'>" + obj.name + "</span>";
            disphtml += "<span style='margin-left: 30px;'><a href='" + downloadUrl + "'>下载</a>";
            disphtml += "<a style='margin-left:10px;' href='javascript:' onclick='removeFile(\"" + obj.id + "\")'>删除</a>";
            disphtml += "</span>";
            var objIdDiv = $("#" + obj.id);
            if (objIdDiv.length > 0) { // 已经存在，替换之
                objIdDiv.html(disphtml);
            } else {
                $("#Picture").append("<div id='" + obj.id + "'>" + disphtml + "</div>");
            }
        };

        target.window(opt);
    }
    //移除
    function removeFile(id) {
        parent.$.messager.confirm('询问', '您是否要删除当前附件？', function (b) {
            if (b) {
                $.post('/PublicInfoManage/Attachment/removeFile', {
                    id: id
                }, function (result) {
                    if (result.type == "1") {
                        $("#" + id).remove();
                    } else {
                        parent.$.messager.alert('错误', result.message, 'error');
                    }

                }, 'JSON');
            }
        });
    }

    function closeTab() {
        parent.$('.page-tabs-content').find('.active i').trigger("click");
    }
</script>
@*////////////////////////////////上传JS-结束////////////////////////////*@
<script>
    var keyValue = request('keyValue');
    $(function () {
        initControl();
    });
    //初始化控件
    function initControl() {

        //获取表单
        if (!!keyValue) {
            $.SetForm({
                url: "../../OrderManager/Order/GetFormJson_file",
                param: { keyValue: keyValue },
                success: function (data) {

                    var inv = data.entitys;
                    $("#form1").SetWebControls(inv);
                    //$("#orderCode").attr("readOnly", "true");//修改时订单号 只读
                    //附件
                    var attach = data.attachs;
                    $.each(attach, function (i, sm) {
                        var downloadUrl = '/PublicInfoManage/Attachment/DownloadFile?id=' + sm.id;
                        var disphtml = "<span style='min-width:10px; display:inline-block;color:blue;'>" + sm.name + "</span>";
                        disphtml += "<span style='margin-left: 30px;'><a href='" + downloadUrl + "'>下载</a>";
                        disphtml += "<a style='margin-left:10px;' href='javascript:' onclick='removeFile(\"" + sm.id + "\")'>删除</a>";
                        disphtml += "</span>";
                        var objIdDiv = $("#" + sm.id);
                        if (objIdDiv.length > 0) { // 已经存在，替换之
                            objIdDiv.html(disphtml);
                        } else {
                            $("#Picture").append("<div id='" + sm.id + "'>" + disphtml + "</div>");
                        }
                    });

                }
            })
        }
    }

    function AcceptClick() {
        //if (!$('#form1').Validform()) {
        //    return false;
        //}
        //var postData = $("#form1").GetWebControls(keyValue);
       
    }
</script>

<div style="margin-top: 20px; margin-right: 30px;">

    <ul class="nav nav-tabs">
        <li class="active"><a href="#BaseInfo" data-toggle="tab">基本信息</a></li>

    </ul>
    <div class="tab-content" style="padding-top: 15px;">
        <div id="BaseInfo" class="tab-pane active">
            <table class="form">

                <tr>
                    <td class="formTitle">工序程序批量上传</td>
                    <td class="formValue">
                        @*<input id="picSourse" type="text" class="form-control" value="无" />*@
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">
                        <div style="padding-top: 5px;">
                            <a class="btn btn-default" data-options="iconCls:'icon-help'" id="btnConfirm" href="javascript:void(0)"
                               onclick="uploadPic()">附件上传<font face="宋体">*</font></a>
                        </div>
                    </th>
                    <td class="formValue" style="height: 85px;" rowspan="3">
                        <div id="Picture" style="padding-left: 50px;"></div>
                    </td>
                </tr>
            </table>

        </div>


    </div>

</div>

