@{
    ViewBag.Title = "Excel数据列表查询方式:普通下拉框";
    Layout = "~/Views/Shared/_Form.cshtml";
}
<script>
    //grid的ID
    var gridId = request('gridId');
    var filename = request('filename');
    var urlTag = request("urlTag");
    var itemId = request("itemId");

    var lisCols = [];
    $(function () {
        var $gridTable = $.currentIframe().$("#" + gridId);
        var columnFields = $gridTable.datagrid('getColumnFields');

        $.each(columnFields, function (i) {
            var field = columnFields[i];

            var columnOption = $gridTable.datagrid('getColumnOption', field);
            lisCols.push(columnOption);
            var title = columnOption.title;
            var hidden = columnOption.hidden;
            if (!!title && hidden == false) {
                $(".sys_spec_text").append("<li data-value='" + field + "' title='" + title + "'><a>" + title + "</a><i></i></li>");
            }
        });
        $(".sys_spec_text li").addClass("active");
        $(".sys_spec_text li").click(function () {
            if (!!$(this).hasClass("active")) {
                $(this).removeClass("active");
            } else {
                $(this).addClass("active").siblings("li");
            }
        });
    });
    //确定导出
    function AcceptClick() {

        var conName = $.currentIframe().$("#queryCondition").find('.dropdown-text').attr('data-value');
        if (typeof (conName) == 'undefined') {
            conName = '';
        }
        var classCode = $("#sysClassCode").val();
        if (typeof (classCode) == 'undefined') {
            classCode = '';
        }

        var conVal = $.currentIframe().$("#txt_Keyword").val();
        var txt = "{ ";
        txt += "\"" + conName + "\":\"" + conVal + "\",";
        txt += "\"" + classCode + "\":\"" + itemId + "\"";
        txt += "}";


        var splitPage = txt;

        //alert(splitPage);

        var exportFields = [];
        $('.sys_spec_text ').find('li.active').each(function () {
            var value = $(this).attr('data-value');
            exportFields.push(value);
        });

        $('#executeexcel').remove();
        //var $form = $("<form id='executeexcel' method='post' action='" + top.contentPath + "/ContractManager/Contract/ExecuteExportExcel' style='display:none;'>");
        var $form = $("<form id='executeexcel' method='post' action='" + top.contentPath + urlTag + "' style='display:none;'>");


        var $input = $("<input type='hidden' name='splitPageV' value='" + splitPage
            + "'><input type='hidden' name='exportFields' value='" + String(exportFields)
            + "'><input type='hidden' name='columnFields' value='" + JSON.stringify(lisCols)
            + "'><input type='hidden' name='filename' value='" + escape(filename) + "'>");
        $("body").append($form);
        $form.append($input).submit();


        //$.ajax({
        //    type: 'POST',
        //    url: '../../ContractManager/Contract/ExecuteExportExcel',
        //    data: { splitPage: splitPage, exportFields: String(exportFields), columnFields: JSON.stringify(lisCols), filename: escape(filename) },
        //    success: function (data) { }
        //});
    }
</script>
<div style="margin: 5px;">
    <div class="alert alert-danger" style="margin-bottom: 5px;">
        <i class="fa fa-question-circle" style="position: relative; top: 1px; font-size: 15px; padding-right: 5px;"></i>
        注：请勾选需要导出的字段
    </div>
</div>
<div style="margin: 5px;">
    <ul class="sys_spec_text"></ul>
</div>
